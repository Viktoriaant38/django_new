{% extends 'parts/base_main.html' %}

{% block title %}All posts{% endblock %}

{% block content %}
<div class="header">
    <div class="header-brand">
        <h3>{% if user.is_authenticated %}Hello, {{ user.username }}{% else %}Welcome{% endif %}</h3>
    </div>
    <div class="header-links">
        <a href="/">Main</a>
        {% if user.is_authenticated %}
            <a href="/user/create-post">Create Post</a>
            <a href="/logout/">Logout</a>
        {% else %}
            <a href="/login/">Login</a>
        {% endif %}
    </div>
</div>

{% for post in posts %}
    <div class="card post-card">
        <div class="post-header">
            <a href="/user/{{post.author.pk}}" class="post-author">@{{ post.author.username }}</a>
            <span class="post-date">{{ post.created_at|date:"d M Y" }}</span>
        </div>

        <div class="post-text">
            {{ post.text }}
        </div>

        <div class="post-actions">
            <form method="post" action="/post/{{post.pk}}/like/">
                {% csrf_token %}
                <button type="submit" class="btn-like {% if user_liked %}active{% endif %}">
                    {% if request.user.pk in post.users_liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
                    <span class="likes-count">{{ post.likes_count }}</span>
                </button>
            </form>
        </div>

        <hr class="divider">

        <div class="comments-section">
            {% for comment in post.comments.all %} <div class="comment">
                    <span class="comment-author">{{ comment.author.username }}</span>
                    <span class="comment-text">{{ comment.text }}</span>
                </div>
            {% empty %}
                <p class="text-muted">No comments yet.</p>
            {% endfor %}
        </div>
    </div>
{% endfor %}
{% endblock %}